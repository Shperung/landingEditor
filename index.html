<html>
<head>
    <title></title>
    <meta charset="UTF-8">
    <style>
      .editable {
        box-shadow: 0 0 0 1px #000;
        padding: 3px;
      }

      .editable:focus {
        box-shadow: 0 0 0 2px green;
        padding: 3px;
      }
    </style>
    
</head>

  <body>
    <h1 id="editable1" class="editable" contenteditable="false">
        h]]</h1>
    <p id="editable2" class="editable" contenteditable="false">text 1</p>
   
    <h2 id="editable3" class="editable" contenteditable="false">
            h2</h2>
    <br>  
    <div id="editable_div1" class="editable" contenteditable="false">
      DIV1fsdfsdfsdfg<div>gxcxc</div><div>g</div><div>g</div><div>g</div><div>g</div></div>g</div><div>g</div><div>g</div><div>g</div><div>g</div></div>g</div><div>g</div><div>g</div><div>g</div><div>g</div></div>
    <br>  
    <p id="editable4" class="editable" contenteditable="false">
        textdasdasd</p>
    <br>
    <div id="editable_div" class="editable" contenteditable="false">
     DIV 2zxsxcasxcascascas</div>




    <section id="editable_s" class="editable" contenteditable="false">
      <div>
        <p>jkj</p><p>ffczxc</p><p>f</p><p>fssc</p><p>f</p><p>f</p><p>f</p><p>f</p><p>f</p><p>f</p><p><br></p>
      </div>
    </section>



    <br>
    <h3 id="editable5" class="editable" contenteditable="false">nav2sxcscscs</h3>
    <p id="editable6" class="editable" contenteditable="false">Text 3g</p>
  
    <b id="editable_b" class="editable" contenteditable="false">bold teg<br>g<br>g<br>g<br>g<br>g<br>xt 1</b>


    <!-- <script src="src/client.js"></script> -->
    <script>

      function editText(isEdit) {
        if (isEdit) {
          const editable = document.getElementsByClassName('editable');
          // edit
          [].forEach.call(editable, function (el) {
            el.addEventListener('click', function() {    
              el.setAttribute("contenteditable", true);
              el.focus();    
            }, false);
            el.addEventListener('blur', function() {    
              el.setAttribute("contenteditable", false);
              const text = el.outerHTML;
              const id = el.getAttribute("id");
              if (text && id) {
                console.log('id:', id);
                console.log('text:', text);
                
                fetch('http://localhost:3012/', {
                  method: 'POST',
                  headers: {
                    'Accept': 'application/json, text/plain, */*',
                    'Content-Type': 'application/json'
                  },
                  body: JSON.stringify({text: text, id: id})
                }).then(res=>res.json())
                  .then(res => console.log(res));
              } else {
                console.log('not data');
                
              }
                
            }, false);
          });
        }
      }
     

      // возвращает cookie с именем name, если есть, если нет, то undefined
      function getCookie(name) {
        var matches = document.cookie.match(new RegExp(
          "(?:^|; )" + name.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + "=([^;]*)"
        ));
        return matches ? decodeURIComponent(matches[1]) : undefined;
      }


      // если на странице /editable то добавляем кнопки
      const isEditadlePath = window.location.pathname === '/editable';
      
      if (isEditadlePath) {
        console.log('isEditadlePath', isEditadlePath);
        
        const editableBlock = document.createElement('div');
        editableBlock.className = "content-editable-block";
        editableBlock.innerHTML = `
        <button class="js--login-btn">login</button>
        <button class="js--logout-btn" hidden>logout</button>
        `;
        document.body.appendChild(editableBlock);
      }
      
      // логинизация
      const isEditadle = getCookie('editable');
      console.log('isEditadle', isEditadle);
      editText(isEditadle);
      
      const loginBtn = document.querySelector('.js--login-btn');
      const logoutBtn = document.querySelector('.js--logout-btn');

      if (isEditadle) {
        loginBtn.setAttribute("hidden", true);
        logoutBtn.removeAttribute("hidden");
      }

      if (logoutBtn) {
        logoutBtn.addEventListener('click', function() {
          if (document.cookie.length) {
            wantLogout = confirm("Do you want logout now?");
            if (wantLogout) {
              document.cookie = 'editable=;expires=Thu, 01 Jan 1970 00:00:01 GMT;';
              document.location.reload(true);
            }
          }
        })
      }



      if (loginBtn && !isEditadle) {
        console.log('loginBtn', loginBtn);
        
        loginBtn.addEventListener('click', function () {
          const promptUserName = prompt("Enter user name", '');
          if (promptUserName ){
            const promptUserPassword =   prompt("Enter password", '');
    
            if(promptUserPassword) {
              console.log('promptUserName', promptUserName);
              console.log('promptUserPassword', promptUserPassword);    
              fetch('http://localhost:3012/', {
                method: 'POST',
                headers: {
                  'Accept': 'application/json, text/plain, */*',
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({userName: promptUserName, userPassword: promptUserPassword})
              }).then(res=> {
                if (res.ok) {
                  console.log('res.ok');
                  loginBtn.setAttribute("hidden", true);
                  logoutBtn.removeAttribute("hidden");
                  alert('Successed login');
                  editText(true);
                } else {
                  alert('Wrong username or password');
                }
              })
                .then(res => console.log(res));        
              }
          }          
        });        
      }
     
      
    </script>
  </body></html>